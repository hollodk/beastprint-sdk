{"version":3,"sources":["../src/index.ts"],"sourcesContent":["export type LegacyPrintOptions = {\n  html?: string;   // raw HTML string to print\n  url?: string;    // URL to open and print\n};\n\nexport type BeastPrintPrinter = {\n  key: string;\n  profileKey?: string;\n};\n\nexport type BeastPrintOptions = {\n  mode?: 'template' | 'html';\n  templateId?: string;\n  widthMm?: number;\n  data?: Record<string, any>;\n  printer?: BeastPrintPrinter;\n  html?: string;   // used when mode === 'html'\n};\n\nexport type PrintStrategy = 'auto' | 'legacy' | 'beast';\n\nexport type PrintOptions = {\n  strategy?: PrintStrategy;\n  legacy?: LegacyPrintOptions;\n  beast?: BeastPrintOptions;\n};\n\nexport async function print(options: PrintOptions = {}): Promise<void> {\n  const strategy: PrintStrategy = options.strategy ?? 'auto';\n\n  if (strategy === 'legacy') {\n    return legacyPrint(options.legacy);\n  }\n\n  if (strategy === 'beast') {\n    return beastPrint(options.beast);\n  }\n\n  // strategy === 'auto'\n  const hasBeastConfig =\n    !!options.beast &&\n    !!options.beast.printer &&\n    typeof options.beast.printer.key === 'string' &&\n    options.beast.printer.key.length > 0;\n\n  if (hasBeastConfig) {\n    try {\n      await beastPrint(options.beast);\n      return;\n    } catch (err) {\n      // Soft failure, then fallback\n      console.warn('[beastprint] BeastPrint failed, falling back to legacy', err);\n    }\n  }\n\n  if (options.legacy) {\n    return legacyPrint(options.legacy);\n  }\n\n  throw new Error('[beastprint] No valid print configuration provided');\n}\n\nasync function legacyPrint(options?: LegacyPrintOptions): Promise<void> {\n  // If nothing is specified, just call browser print\n  if (!options || (!options.html && !options.url)) {\n    if (typeof window !== 'undefined' && typeof window.print === 'function') {\n      window.print();\n      return;\n    }\n    throw new Error('[beastprint] window.print() is not available');\n  }\n\n  // Case: URL printing\n  if (options.url) {\n    if (typeof window === 'undefined') {\n      throw new Error('[beastprint] Cannot open window in non-browser environment');\n    }\n\n    const win = window.open(options.url, '_blank');\n    if (!win) {\n      throw new Error('[beastprint] Popup blocked or failed to open window');\n    }\n\n    win.addEventListener('load', () => {\n      try {\n        win.focus();\n        win.print();\n      } catch (err) {\n        console.error('[beastprint] Failed to print from opened window', err);\n      }\n    });\n\n    return;\n  }\n\n  // Case: HTML string printing\n  if (options.html) {\n    if (typeof document === 'undefined') {\n      throw new Error('[beastprint] Cannot create iframe in non-browser environment');\n    }\n\n    const iframe = document.createElement('iframe');\n    iframe.style.position = 'fixed';\n    iframe.style.right = '0';\n    iframe.style.bottom = '0';\n    iframe.style.width = '0';\n    iframe.style.height = '0';\n    iframe.style.border = '0';\n    iframe.style.visibility = 'hidden';\n\n    document.body.appendChild(iframe);\n\n    const iframeWindow = iframe.contentWindow;\n    if (!iframeWindow) {\n      iframe.remove();\n      throw new Error('[beastprint] Failed to access iframe.contentWindow');\n    }\n\n    const doc = iframeWindow.document;\n    doc.open();\n    doc.write(options.html);\n    doc.close();\n\n    iframe.onload = () => {\n      try {\n        iframeWindow.focus();\n        iframeWindow.print();\n      } catch (err) {\n        console.error('[beastprint] Failed to print from iframe', err);\n      } finally {\n        setTimeout(() => {\n          iframe.remove();\n        }, 1000);\n      }\n    };\n\n    return;\n  }\n}\n\nasync function beastPrint(options?: BeastPrintOptions): Promise<void> {\n  if (!options) {\n    throw new Error('[beastprint] No BeastPrint options provided');\n  }\n\n  if (!options.printer || !options.printer.key) {\n    throw new Error('[beastprint] printer.key is required for BeastPrint');\n  }\n\n  const mode = options.mode ?? 'template';\n\n  const body: any = {\n    mode,\n    widthMm: options.widthMm ?? 80,\n    printer: {\n      key: options.printer.key,\n      profileKey: options.printer.profileKey\n    }\n  };\n\n  if (mode === 'template') {\n    if (!options.templateId) {\n      throw new Error('[beastprint] templateId is required when mode=\"template\"');\n    }\n    body.templateId = options.templateId;\n    body.data = options.data ?? {};\n  } else if (mode === 'html') {\n    if (!options.html) {\n      throw new Error('[beastprint] html is required when mode=\"html\"');\n    }\n    body.html = options.html;\n  } else {\n    throw new Error(`[beastprint] Unsupported mode: ${mode}`);\n  }\n\n  const response = await fetch('https://print.beastscan.com/print', {\n    method: 'POST',\n    headers: {\n      accept: 'application/json',\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(body)\n  });\n\n  if (!response.ok) {\n    let errorMessage = `BeastPrint error: ${response.status}`;\n    try {\n      const text = await response.text();\n      if (text) errorMessage += ` - ${text}`;\n    } catch {\n      // ignore parse error\n    }\n    throw new Error(errorMessage);\n  }\n\n  // For now, keep API as Promise<void>.\n}\n"],"mappings":"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","names":[]}