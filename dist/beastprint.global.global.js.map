{"version":3,"sources":["../src/index.ts","../src/global.ts"],"sourcesContent":["export type LegacyPrintOptions = {\n  html?: string;   // raw HTML string to print\n  url?: string;    // URL to open and print\n};\n\nexport type BeastPrintPrinter = {\n  key: string;\n  profileKey?: string;\n};\n\nexport type BeastPrintOptions = {\n  mode?: 'template' | 'html';\n  templateId?: string;\n  widthMm?: number;\n  data?: Record<string, any>;\n  printer?: BeastPrintPrinter;\n  html?: string;   // used when mode === 'html'\n};\n\nexport type PrintStrategy = 'auto' | 'legacy' | 'beast';\n\nexport type PrintOptions = {\n  strategy?: PrintStrategy;\n  legacy?: LegacyPrintOptions;\n  beast?: BeastPrintOptions;\n};\n\nexport async function print(options: PrintOptions = {}): Promise<void> {\n  const strategy: PrintStrategy = options.strategy ?? 'auto';\n\n  if (strategy === 'legacy') {\n    return legacyPrint(options.legacy);\n  }\n\n  if (strategy === 'beast') {\n    return beastPrint(options.beast);\n  }\n\n  // strategy === 'auto'\n  const hasBeastConfig =\n    !!options.beast &&\n    !!options.beast.printer &&\n    typeof options.beast.printer.key === 'string' &&\n    options.beast.printer.key.length > 0;\n\n  if (hasBeastConfig) {\n    try {\n      await beastPrint(options.beast);\n      return;\n    } catch (err) {\n      // Soft failure, then fallback\n      console.warn('[beastprint] BeastPrint failed, falling back to legacy', err);\n    }\n  }\n\n  if (options.legacy) {\n    return legacyPrint(options.legacy);\n  }\n\n  throw new Error('[beastprint] No valid print configuration provided');\n}\n\nasync function legacyPrint(options?: LegacyPrintOptions): Promise<void> {\n  // If nothing is specified, just call browser print\n  if (!options || (!options.html && !options.url)) {\n    if (typeof window !== 'undefined' && typeof window.print === 'function') {\n      window.print();\n      return;\n    }\n    throw new Error('[beastprint] window.print() is not available');\n  }\n\n  // Case: URL printing\n  if (options.url) {\n    if (typeof window === 'undefined') {\n      throw new Error('[beastprint] Cannot open window in non-browser environment');\n    }\n\n    const win = window.open(options.url, '_blank');\n    if (!win) {\n      throw new Error('[beastprint] Popup blocked or failed to open window');\n    }\n\n    win.addEventListener('load', () => {\n      try {\n        win.focus();\n        win.print();\n      } catch (err) {\n        console.error('[beastprint] Failed to print from opened window', err);\n      }\n    });\n\n    return;\n  }\n\n  // Case: HTML string printing\n  if (options.html) {\n    if (typeof document === 'undefined') {\n      throw new Error('[beastprint] Cannot create iframe in non-browser environment');\n    }\n\n    const iframe = document.createElement('iframe');\n    iframe.style.position = 'fixed';\n    iframe.style.right = '0';\n    iframe.style.bottom = '0';\n    iframe.style.width = '0';\n    iframe.style.height = '0';\n    iframe.style.border = '0';\n    iframe.style.visibility = 'hidden';\n\n    document.body.appendChild(iframe);\n\n    const iframeWindow = iframe.contentWindow;\n    if (!iframeWindow) {\n      iframe.remove();\n      throw new Error('[beastprint] Failed to access iframe.contentWindow');\n    }\n\n    const doc = iframeWindow.document;\n    doc.open();\n    doc.write(options.html);\n    doc.close();\n\n    iframe.onload = () => {\n      try {\n        iframeWindow.focus();\n        iframeWindow.print();\n      } catch (err) {\n        console.error('[beastprint] Failed to print from iframe', err);\n      } finally {\n        setTimeout(() => {\n          iframe.remove();\n        }, 1000);\n      }\n    };\n\n    return;\n  }\n}\n\nasync function beastPrint(options?: BeastPrintOptions): Promise<void> {\n  if (!options) {\n    throw new Error('[beastprint] No BeastPrint options provided');\n  }\n\n  if (!options.printer || !options.printer.key) {\n    throw new Error('[beastprint] printer.key is required for BeastPrint');\n  }\n\n  const mode = options.mode ?? 'template';\n\n  const body: any = {\n    mode,\n    widthMm: options.widthMm ?? 80,\n    printer: {\n      key: options.printer.key,\n      profileKey: options.printer.profileKey\n    }\n  };\n\n  if (mode === 'template') {\n    if (!options.templateId) {\n      throw new Error('[beastprint] templateId is required when mode=\"template\"');\n    }\n    body.templateId = options.templateId;\n    body.data = options.data ?? {};\n  } else if (mode === 'html') {\n    if (!options.html) {\n      throw new Error('[beastprint] html is required when mode=\"html\"');\n    }\n    body.html = options.html;\n  } else {\n    throw new Error(`[beastprint] Unsupported mode: ${mode}`);\n  }\n\n  const response = await fetch('https://print.beastscan.com/print', {\n    method: 'POST',\n    headers: {\n      accept: 'application/json',\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(body)\n  });\n\n  if (!response.ok) {\n    let errorMessage = `BeastPrint error: ${response.status}`;\n    try {\n      const text = await response.text();\n      if (text) errorMessage += ` - ${text}`;\n    } catch {\n      // ignore parse error\n    }\n    throw new Error(errorMessage);\n  }\n\n  // For now, keep API as Promise<void>.\n}\n","import { print } from './index';\n\ndeclare global {\n  interface Window {\n    beastprint?: {\n      print: typeof print;\n    };\n  }\n}\n\nif (typeof window !== 'undefined') {\n  window.beastprint = { print };\n}\n"],"mappings":"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","names":["print","options","_a","strategy","legacyPrint","beastPrint","err","win","iframe","iframeWindow","doc","_b","_c","mode","body","response","errorMessage","text","print"]}